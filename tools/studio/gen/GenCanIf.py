import sys,os
import xml.etree.ElementTree as ET

__all__ = ['GenCanIf']

__Header = \
"""/*
* Configuration of module: CanIf
*
* Created by:   parai          
* Copyright:    (C)parai@foxmail.com  
*
* Configured for (MCU):    MinGW ...
*
* Module vendor:           ArcCore
* Generator version:       2.0.34
*
* Generated by easySAR Studio (https://github.com/parai/OpenSAR)
*/
"""

__dir = '.'
__root = None


def GenCanIf(wfxml):
    global __dir,__root
    __root = ET.parse(wfxml).getroot();
    __dir = os.path.dirname(wfxml)
    GenH()

def GenH():
    global __dir,__root
    fp = open('%s/CanIf_Cfg.h'%(__dir),'w')
    fp.write(__Header)
    fp.write("""
#ifndef CANIF_CFG_H_
#define CANIF_CFG_H_

#include "Can.h"

#define CANIF_VERSION_INFO_API   STD_OFF

#if defined(USE_DET)
#define CANIF_DEV_ERROR_DETECT   STD_ON
#else
#define CANIF_DEV_ERROR_DETECT   STD_OFF
#endif
#define CANIF_DLC_CHECK          STD_OFF
#define CANIF_MULITPLE_DRIVER_SUPPORT       STD_OFF   // Not supported
#define CANIF_READRXPDU_DATA_API             STD_OFF   // Not supported
#define CANIF_READRXPDU_NOTIFY_STATUS_API     STD_OFF   // Not supported
#define CANIF_READTXPDU_NOTIFY_STATUS_API     STD_OFF   // Not supported
#define CANIF_SETDYNAMICTXID_API            STD_OFF   // Not supported
#define CANIF_WAKEUP_EVENT_API                 STD_OFF   // Not supported
#define CANIF_TRANSCEIVER_API               STD_OFF   // Not supported
#define CANIF_TRANSMIT_CANCELLATION         STD_OFF   // Not supported
#define CANIF_ARC_RUNTIME_PDU_CONFIGURATION STD_OFF   // Not supported
#define CANIF_CANPDUID_READDATA_API         STD_OFF   // Not supported
#define CANIF_READRXPDU_NOTIF_STATUS_API    STD_OFF   // Not supported
    """)
    ### I am lasy, by default I configure out two UDS server, Id unchangeable
    fp.write("""
/* Tx PduId For CanIF */
#define CANIF_DIAG_P2P_ACK        0
#define CANIF_DIAG_P2A_ACK        1
/* Rx PduId For CanIF */
#define CANIF_DIAG_P2P_REQ        0
#define CANIF_DIAG_P2A_REQ        1
    """)
    fp.close()